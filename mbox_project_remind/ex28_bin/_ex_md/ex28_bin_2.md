ex28_bin_2のサブジェクトを提示します。ただし、phase1のドキュメントには具体的なex28_bin_2の詳細が記載されていないようなので、今から作成します。

---

## ex28_bin_2: BMPヘッダー情報の抽出

**ファイル名**: `ex28_bin_2_bmp_header.py`

**目的**: BMPファイルのヘッダー構造を理解し、Pythonの`struct`モジュールを使ってバイナリデータを構造化された情報として解釈する

**理論的背景**:

バイナリファイルは、単なるバイト列ではなく、構造を持っています。BMPファイルの先頭54バイトには、ファイル全体の構造を記述する「ヘッダー情報」が格納されています。

BMPヘッダーは二つの部分から構成されています。

**ファイルヘッダー（14バイト）**:
- オフセット0-1: ファイル識別子（常に"BM"）
- オフセット2-5: ファイルサイズ（4バイト、リトルエンディアン）
- オフセット6-9: 予約領域（通常は0）
- オフセット10-13: 画像データの開始位置（4バイト）

**情報ヘッダー（40バイト、標準的なDIBヘッダーの場合）**:
- オフセット14-17: このヘッダーのサイズ（通常は40）
- オフセット18-21: 画像の幅（ピクセル、4バイト）
- オフセット22-25: 画像の高さ（ピクセル、4バイト）
- オフセット26-27: プレーン数（常に1）
- オフセット28-29: ビット深度（1, 4, 8, 16, 24, 32のいずれか）
- オフセット30-33: 圧縮方式（0=無圧縮）
- オフセット34-37: 画像データサイズ
- オフセット38-41: 水平解像度（ピクセル/メートル）
- オフセット42-45: 垂直解像度（ピクセル/メートル）
- オフセット46-49: 使用色数
- オフセット50-53: 重要色数

**課題内容**:

`sample.bmp`ファイルからヘッダー情報を読み取り、以下の情報を人間が読みやすい形式で表示するプログラムを書いてください。

- ファイル識別子（BMであることの確認）
- ファイルサイズ（バイト単位とMB単位の両方）
- 画像の幅と高さ（ピクセル）
- ビット深度
- 圧縮方式（0なら"無圧縮"と表示）

**要件**:

- `struct`モジュールを使用すること
- コマンドライン引数でファイル名を受け取ること
- ファイル識別子が"BM"でない場合はエラーメッセージを表示すること
- 各情報にラベルを付けて見やすく整形すること
- ファイルサイズはバイト単位に加えて、適切な単位（KB, MB）でも表示すること

**実装のヒント**:

`struct.unpack()`を使ってバイナリデータを解釈します。書式文字列の主な記号は以下の通りです。

- `<` : リトルエンディアン（BMPファイルで使用）
- `H` : 符号なし2バイト整数（unsigned short）
- `I` : 符号なし4バイト整数（unsigned int）
- `i` : 符号付き4バイト整数（signed int、高さは負の値の場合がある）

複数の値を一度に読み取ることもできます。

```python
import struct

# ファイルヘッダー（14バイト）を読み取る例
with open('sample.bmp', 'rb') as f:
    # 最初の2バイトを文字列として読む
    signature = f.read(2)

    # 次の4バイトをリトルエンディアンの符号なし整数として読む
    file_size_data = f.read(4)
    file_size = struct.unpack('<I', file_size_data)[0]

    # または、まとめて読むこともできる
    f.seek(0)  # ファイルの先頭に戻る
    header_data = f.read(14)
    # '2s'は2バイトの文字列、'I'は4バイト整数、'4x'は4バイトスキップ
    signature, file_size, data_offset = struct.unpack('<2sIxxxxI', header_data)
```

`seek()`メソッドは、ファイル内の読み取り位置を移動します。`seek(0)`は先頭に、`seek(18)`はオフセット18に移動します。

**期待される出力**:

```
=== BMP Header Information ===
File Type: BM
File Size: 30054 bytes (29.3 KB)
Image Offset: 54 bytes
Image Width: 100 pixels
Image Height: 100 pixels
Bit Depth: 24 bits
Compression: None (0)
```

**学習ポイント**:

この演習を通じて、以下を理解します。

- バイナリデータを特定の型として解釈する方法
- ファイル内の特定位置からデータを読み取る方法
- リトルエンディアンとビッグエンディアンの違い
- ファイルフォーマットの仕様を読み解く能力
- バイト数を人間が読みやすい単位に変換する方法

**追加課題（オプション）**:

余裕があれば、以下の機能も追加してみてください。

1. 画像の総ピクセル数を計算して表示
2. 1ピクセルあたりのバイト数を計算
3. 理論的な画像データサイズと実際のファイルサイズを比較
4. エラーハンドリング（ファイルが存在しない、BMPファイルでない、など）

---

この課題を実装してみてください。`struct`モジュールの使い方が不明な点があれば、具体的な部分を質問してください。実装に詰まったら、いつでも聞いてください。
